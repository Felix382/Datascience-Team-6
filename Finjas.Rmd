---
title: "R Notebook"
output: html_notebook
---
---
title: "R Notebook"
output: html_notebook
---


```{r}
library(readr)
library(lubridate)
library(ggplot2)
library(dplyr)
library(readxl)

umsatzdaten <- read_csv("data/umsatzdaten_gekuerzt.csv")
kiwo<- read_csv("data/kiwo.csv")

merger<-left_join(umsatzdaten,kiwo)
#View (merger)

Zeiten <- read_excel("Zeiten.xlsx")
#View(Zeiten)

Zeiten <- Zeiten %>% 
mutate(Datum = as.Date(Datum)) 

merger <- merger %>% 
mutate(Datum = as.Date(Datum)) 



merger2<-left_join(merger,Zeiten, by='Datum')
View(merger2)

merger2[is.na(merger2)]<-0

merger2$wochentag <- weekdays(merger2$Datum)
View(merger2)

#View(merger2)


feiertage <- read_csv("data/feiertage.csv")


#View(feiertage)


merger3<-left_join(merger2,feiertage)
View(merger3)

merger3[is.na(merger3)]<-0

View(merger3)


```


```{r}

wetter <- read_csv("data/wetter.csv")
#View(wetter)

final<-left_join(merger3,wetter)

View(final)


#Relevant: Temperatur, Bewölkung
#Irrelevant: Windgeschwindigkeit, Wettercode zu viele NAs

#Monatsdurchschnittstemperatur

#Dummy for month and then average of the month, but the years cross
#seven days before and after the observation, dont know the code


```


```{r}

#Dummy für Wochentage, Stena Line fährt jeden Tag

final%>%
mutate(Dummy = ifelse(wochentag=='Dienstag', "1", "0"))


library (pracma)

movavg(wetter$Temperatur, 7, type=c("s"))



```

```{r}
plot_warengruppe <- function(WG) {
  
  umsatzWGMo <- c(umsatz[Warengruppe == WG & wday(ymd(Datum)) == 1]$Umsatz)
  umsatzWGDi <- c(umsatz[Warengruppe == WG & wday(ymd(Datum)) == 2]$Umsatz)
  umsatzWGMi <- c(umsatz[Warengruppe == WG & wday(ymd(Datum)) == 3]$Umsatz)
  umsatzWGDo <- c(umsatz[Warengruppe == WG & wday(ymd(Datum)) == 4]$Umsatz)
  umsatzWGFr <- c(umsatz[Warengruppe == WG & wday(ymd(Datum)) == 5]$Umsatz)
  umsatzWGSa <- c(umsatz[Warengruppe == WG & wday(ymd(Datum)) == 6]$Umsatz)
  umsatzWGSo <- c(umsatz[Warengruppe == WG & wday(ymd(Datum)) == 7]$Umsatz)
  data <- data.frame(
    WG1 = c("Mo", "Di", "Mi", "Do", "Fr", "Sa", "So"),
    value = c(mean(umsatzWGMo), mean(umsatzWGDi), mean(umsatzWGMi), mean(umsatzWGDo), mean(umsatzWGFr), mean(umsatzWGSa), mean(umsatzWGSo)),
    sd = c(sd(umsatzWGMo), sd(umsatzWGDi) , sd(umsatzWGMi) , sd(umsatzWGDo) , sd(umsatzWGFr) , sd(umsatzWGSa), sd(umsatzWGSo))
  )
  
  ggplot(data) + 
    geom_bar( aes(x = WG1, y = value), stat="identity", fill="skyblue", alpha=0.7) +
    geom_errorbar( aes(x = WG1, ymin = value - sd, ymax = value + sd), width = 0.4, colour ="orange", alpha= 0.9, size = 1.3) + 
    scale_x_discrete(paste("Warengruppe ", WG))
}

plot_warengruppe(1)

```